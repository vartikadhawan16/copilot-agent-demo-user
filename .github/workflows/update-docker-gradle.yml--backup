name: Sync Docker and Gradle Configurations

on:
  issues:
    types: [opened]

jobs:
  sync-config:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout Target Repo
      - name: Checkout Target Repo
        uses: actions/checkout@v3

      # Step 2: Checkout Reference Repo
      - name: Checkout Reference Repo
        uses: actions/checkout@v3
        with:
          repository: vartikadhawan16/copilot-agent-demo-org
          token: ${{ secrets.GH_PAT }}
          path: reference-repo

      # Step 3: Copy Docker and Gradle Files from Reference Repo
      - name: Copy Docker and Gradle Files
        run: |
          mkdir -p docker
          cp reference-repo/docker/Dockerfile ./docker/Dockerfile || true
          cp reference-repo/build.gradle ./build.gradle || true
          cp reference-repo/settings.gradle ./settings.gradle || true
          cp -r reference-repo/gradle ./gradle || true
          cp reference-repo/gradlew ./gradlew || true
          cp reference-repo/gradlew.bat ./gradlew.bat || true

      # Step 4: Create Branch and Commit Changes
      - name: Commit Changes
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git checkout -b sync-docker-gradle
          git add .
          git commit -m "Synced Docker and Gradle configurations from reference repo"

      # Step 5: Push Branch and Create Pull Request
      - name: Push Branch
        run: git push origin sync-docker-gradle

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GH_PAT }}
          title: "Sync Docker and Gradle Configurations"
          body: |
            Automated update based on reference repo:
            - Dockerfile and related configurations added/updated
            - build.gradle and settings.gradle aligned with reference standards
            - Gradle wrapper and scripts synced
          base: main
